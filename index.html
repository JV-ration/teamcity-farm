---
layout: default
title: TeamCity Farm
tagline: Project to create VM with docker based TeamCity server and agents
---
<p>TeamCity from JetBrains is my favorite build server. It “knows” what developers need, it simply works 
out-of-the-box instead of you spending time making it to work. There is an option to get it installed quickly with 
trial installation topology, when both server and single agent run on the same box. However it is preferable to 
isolate them from each other.</p>
<p>TeamCity Farm is a Maven project, which results in ZIP-archive with <strong>Vagrant project</strong>.
The later</p>

<ul>
<li>creates <strong>VM with Centos 7.0</strong>
</li>
<li>installs Docker</li>
<li>pull necessary images and starts <strong>Docker containers</strong> with

<ul>
<li>mySQL database</li>
<li>TeamCity 9 build server</li>
<li>2 TeamCity agents</li>
</ul>
</li>
</ul>

<p>The created Centos VM and installed Docker repeat your network proxy settings. Therefore you can use the project behind the company firewall</p>

<p><strong>Final result</strong>: Ready for use TeamCity build server becomes available on your machine at <a href="http://localhost:8112/">http://localhost:8112/</a></p>

<h3>
<a id="how-to-use-it" class="anchor" href="#how-to-use-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use it?</h3>

<p><strong>Get Vagrant project</strong></p>

<p>You can either download the released project using a button on the right or get sources and run Maven. 
The sources can be downloaded using a button on the right or, to get latest sources from GitHub, clone the repository</p>

<pre><code>git clone https://github.com/JV-ration/teamcity-farm.git
cd teamcity-farm
</code></pre>

<p>Then change to the directory with unpacked sources and</p>

<pre><code>mvn clean package
</code></pre>

<p>The line above will prepare ZIP file with Vagrant project in <code>target</code> folder.
    The line below will even unpack the ZIP in <code>target/its/team-city-farm-0.0.2-SNAPSHOT</code> folder</p>

<pre><code>mvn clean pre-integration-test -Prun-its
</code></pre>


<p><strong>Create and run VM</strong></p>

<p>Unpack the archive with Vagrant project and change to that directory
Run the command below to create VM and prepare the build server</p>

<pre><code>bin/vagrant/vagrant-up.sh vagrant.lck
</code></pre>

<p><strong>Finish configuration of the build server</strong></p>

<p>When VM is fully provisioned</p>

<ul>
<li>open the build server at <a href="http://localhost:8112/">http://localhost:8112/</a>
</li>
<li>accept JetBrains TeamCity license</li>
<li>enter the desired administrator name and password</li>
<li>authorize both agents</li>
</ul>

<p><strong>Happy Building ;-)</strong></p>

<img src="images/happy-building.png"/>

<h3>
<a id="what-to-expect-shortly" class="anchor" href="#what-to-expect-shortly" aria-hidden="true"><span class="octicon octicon-link"></span></a>What to expect shortly?</h3>

<ul>
<li>Scripts for running <strong>Docker containers</strong> directly on your machine, so don't have use Vagrant and Virtual Box. Basically
    there will be three different starting points:
<ul><li>your platform does not support Docker => start with Vagrant, which will bring you to the next starting point;</li>
    <li>your box is vanilla installation => start with installation of Docker;</li>
    <li>your box has Docker => just pull images and start containers</li>
</ul></li>
<li>Utilization of <a href="http://www.fig.sh/" title="http://www.fig.sh/">fig</a> to simplify Docker commands</li>
<li>Whatever is seen the project <a href="https://github.com/JV-ration/teamcity-farm/issues">issues</a>
</li>
</ul>

<h3>
<a id="pre-required-software" class="anchor" href="#pre-required-software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pre-required software</h3>

<ul>
<li>Recent JDK</li>
<li>Maven 3.0.4 or higher, unless you download released Vagrant project</li>
<li>Vagrant for managing virtual machine with</li>
<li>Virtual Box (or another virtualization provider)</li>
</ul>

<h3>
<a id="who-do-i-talk-to" class="anchor" href="#who-do-i-talk-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Who do I talk to?</h3>

<ul>
<li>Viktor Sadovnikov <a href="https://twitter.com/sadovnikov">@sadovnikov</a>
</li>
</ul>
